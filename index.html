<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Business Card</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* --- スマートで落ち着いた配色 --- */
        :root {
            --bg-color: #1a1a1a;       /* 背景：濃いグレー */
            --card-bg: #252525;        /* カード：少し明るいグレー */
            --text-main: #ffffff;      /* 白 */
            --text-sub: #b0b0b0;       /* 薄いグレー */
            --accent-color: #3b82f6;   /* 知的なブルー */
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Roboto Mono', monospace; /* 等幅フォントでデジタル感を演出 */
            background-color: var(--bg-color);
            color: var(--text-main);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        /* --- カードデザイン (シンプルで上質に) --- */
        .card-container {
            width: 90%;
            max-width: 380px;
            background-color: var(--card-bg);
            border-radius: 16px;
            /* 派手な光ではなく、上品な影をつける */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            padding: 40px 30px;
            text-align: center;
            opacity: 0; /* 最初は隠す */
            transition: opacity 0.8s ease;
            border: 1px solid #333;
        }

        /* --- プロフィール画像 --- */
        .profile-img {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--accent-color);
            margin-bottom: 25px;
            background-color: #333;
        }

        /* --- テキスト情報 --- */
        h1 {
            font-size: 22px;
            margin: 0 0 8px 0;
            font-weight: 700;
            letter-spacing: 0.5px;
            min-height: 1.5em; /* 高さを確保してガタツキ防止 */
        }

        .job-title {
            font-size: 14px;
            color: var(--accent-color);
            font-weight: 500;
            margin-bottom: 5px;
            display: block;
            min-height: 1.5em;
        }

        .company-name {
            font-size: 13px;
            color: var(--text-sub);
            margin-bottom: 25px;
            display: block;
            min-height: 1.5em;
        }

        .bio {
            font-size: 13px;
            color: #d1d1d1;
            line-height: 1.8;
            margin-bottom: 35px;
            text-align: left;
            min-height: 4em;
            padding: 0 5px;
            border-left: 2px solid #444; /* 左に控えめなライン */
            padding-left: 15px;
        }

        /* --- タイプライター演出のカーソル --- */
        .typing-cursor::after {
            content: '|';
            animation: blink 1s infinite;
            color: var(--accent-color);
            margin-left: 2px;
            font-weight: lighter;
        }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }

        /* --- リンクボタン (フラットでモダンに) --- */
        .links-container {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .link-btn {
            display: none; /* データロード後に表示 */
            align-items: center;
            justify-content: center;
            padding: 14px;
            background-color: #333;
            color: var(--text-main);
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s ease;
            font-size: 14px;
            border: 1px solid #444;
        }

        .link-btn:hover {
            background-color: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
            transform: translateY(-2px);
        }

        .link-btn i {
            margin-right: 10px;
            font-size: 16px;
        }

        /* ロード画面 */
        #loading {
            position: fixed;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            color: var(--text-sub);
            font-size: 14px;
            font-weight: 500;
        }
    </style>
</head>
<body>

    <div id="loading">Loading data...</div>

    <div class="card-container" id="mainCard">
        <img src="https://via.placeholder.com/150/333333/ffffff?text=USER" alt="Profile" class="profile-img" id="profileImg">

        <h1 id="nameDisplay"></h1>
        <span id="jobDisplay" class="job-title"></span>
        <span id="companyDisplay" class="company-name"></span>
        
        <p id="bioDisplay" class="bio"></p>

        <div class="links-container">
            <a id="webLink" href="#" class="link-btn" target="_blank">
                <i class="fas fa-globe"></i> Website
            </a>
            <a id="twitterLink" href="#" class="link-btn" target="_blank">
                <i class="fab fa-twitter"></i> X (Twitter)
            </a>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

         // ★★★ ここに Step 3 で取得したコードを貼り付けてください！ ★★★
        const firebaseConfig = {
            apiKey: "AIzaSyB4j_6qxxuLNOtaQPmvijHL4QPk_6I3vC0",
            authDomain: "digital-meishi.firebaseapp.com",
            projectId: "digital-meishi",
            storageBucket: "digital-meishi.firebasestorage.app",
            messagingSenderId: "380152343881",
            appId: "1:380152343881:web:fb3b6cdb50c4b12f7d7e98"
        };
        // ★★★ 貼り付けここまで ★★★

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // タイプライター演出（少し滑らかに）
        async function typeWriter(elementId, text, speed = 30) {
            const element = document.getElementById(elementId);
            if (!text) {
                element.innerHTML = ""; 
                return;
            }
            
            element.innerHTML = ""; 
            element.classList.add("typing-cursor");

            for (let i = 0; i < text.length; i++) {
                element.textContent += text.charAt(i);
                // ランダム要素を減らして、スマートで一定のリズムに
                await new Promise(resolve => setTimeout(resolve, speed));
            }

            element.classList.remove("typing-cursor");
        }

        async function loadCard() {
            const params = new URLSearchParams(window.location.search);
            const cardId = params.get('id');

            if (!cardId) {
                document.getElementById('loading').innerText = "IDが指定されていません";
                return;
            }

            try {
                const docRef = doc(db, "cards", cardId);
                const docSnap = await getDoc(docRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();

                    // 1. ロード表示を消してカードをふわっと表示
                    document.getElementById('loading').style.display = 'none';
                    const mainCard = document.getElementById('mainCard');
                    mainCard.style.opacity = 1;

                    // 2. テキストアニメーション開始
                    // 名前は少しゆっくり堂々と
                    await typeWriter('nameDisplay', data.name || "No Name", 50);
                    
                    // 肩書きと会社名は少し早めに
                    await typeWriter('jobDisplay', data.job || "", 30);
                    document.getElementById('companyDisplay').innerText = data.company || "";
                    
                    // 自己紹介はスピーディーに
                    await typeWriter('bioDisplay', data.bio || "", 15);

                    // 3. ボタン表示
                    if(data.website) {
                        const wBtn = document.getElementById('webLink');
                        wBtn.href = data.website;
                        wBtn.style.display = "flex";
                    }
                    if(data.twitter) {
                        const tBtn = document.getElementById('twitterLink');
                        tBtn.href = "https://twitter.com/" + data.twitter.replace('@','');
                        tBtn.style.display = "flex";
                    }

                } else {
                    document.getElementById('loading').innerText = "データが見つかりません";
                }
            } catch (e) {
                document.getElementById('loading').innerText = "エラー: " + e.message;
            }
        }

        loadCard();
    </script>
</body>
</html>
